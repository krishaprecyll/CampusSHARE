import { useState, useEffect, useMemo } from 'react';
import {
  Search,
  MapPin,
  Shield,
  Clock,
  Package,
  Users,
  Star
} from 'lucide-react';

import ItemCard from './components/ItemCard';
import CategoryFilter from './components/CategoryFilter';
import Hero from './components/Hero';
import Stats from './components/Stats';
import SafeZoneTransaction from './components/SafeZoneTransaction';

interface Item {
  id: string;
  name: string;
  description: string;
  category: string;
  image_url: string;
  condition: string;
  available: boolean;
  rental_fee: number;
  rental_duration_days: number;
  deposit_amount: number;
  owner_id: string;
}

interface SafeZone {
  id: string;
  name: string;
  location: string;
  status: string;
}

interface Transaction {
  id: string;
  itemName: string;
  itemCategory: string;
  rentalFee: number;
  rentalDate: string;
  safeZoneId: string;
  renter: {
    id: string;
    name: string;
    rating: number;
    reviews: number;
    initials: string;
  };
  owner: {
    id: string;
    name: string;
    rating: number;
    reviews: number;
    initials: string;
  };
}

function App() {
  const [searchQuery, setSearchQuery] = useState('');
  const [selectedCategory, setSelectedCategory] = useState('all');
  const [items, setItems] = useState<Item[]>([]);
  const [safeZones, setSafeZones] = useState<SafeZone[]>([]);
  const [transactions, setTransactions] = useState<Transaction[]>([]);

  useEffect(() => {
    const mockItems: Item[] = [
      {
        id: '1',
        name: 'Professional Camera Kit',
        description: 'Canon EOS R6 with 24-70mm lens',
        category: 'Electronics',
        image_url:
          'https://images.pexels.com/photos/90946/pexels-photo-90946.jpeg',
        condition: 'Excellent',
        available: true,
        rental_fee: 2500,
        rental_duration_days: 3,
        deposit_amount: 10000,
        owner_id: '1'
      },
      {
        id: '2',
        name: 'Mountain Bike',
        description: 'Trek X-Caliber 8, great for trails',
        category: 'Sports',
        image_url:
          'https://images.pexels.com/photos/100582/pexels-photo-100582.jpeg',
        condition: 'Good',
        available: true,
        rental_fee: 1500,
        rental_duration_days: 1,
        deposit_amount: 5000,
        owner_id: '2'
      },
      {
        id: '3',
        name: 'Gaming Console (PS5)',
        description: 'PlayStation 5 with two controllers',
        category: 'Electronics',
        image_url:
          'https://images.pexels.com/photos/371924/pexels-photo-371924.jpeg',
        condition: 'Excellent',
        available: false,
        rental_fee: 2200,
        rental_duration_days: 7,
        deposit_amount: 15000,
        owner_id: '3'
      }
    ];

    const mockSafeZones: SafeZone[] = [
      {
        id: '1',
        name: 'Student Union',
        location: 'Main lobby',
        status: 'Active'
      },
      {
        id: '2',
        name: 'Library Entrance',
        location: 'Security desk area',
        status: 'Active'
      }
    ];

    const mockTransactions: Transaction[] = [
      {
        id: 'txn-1',
        itemName: 'Professional Camera Kit',
        itemCategory: 'Electronics',
        rentalFee: 2500,
        rentalDate: 'Today, 2:00 PM',
        safeZoneId: '1',
        renter: {
          id: 'student-101',
          name: 'Sarah Chen',
          rating: 4.8,
          reviews: 23,
          initials: 'SC'
        },
        owner: {
          id: 'student-102',
          name: 'Marcus Johnson',
          rating: 4.9,
          reviews: 31,
          initials: 'MJ'
        }
      }
    ];

    setItems(mockItems);
    setSafeZones(mockSafeZones);
    setTransactions(mockTransactions);
  }, []);

  const filteredItems = useMemo(() => {
    return items.filter((item) => {
      const matchesSearch =
        item.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
        item.description.toLowerCase().includes(searchQuery.toLowerCase());

      const matchesCategory =
        selectedCategory === 'all' || item.category === selectedCategory;

      return matchesSearch && matchesCategory;
    });
  }, [items, searchQuery, selectedCategory]);

  const handleRent = (itemId: string) => {
    alert(`Rental request sent for item ID: ${itemId}`);
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-cyan-50 scroll-smooth">
      {/* HEADER */}
      <header className="bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-50 border-b">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center justify-between">
          <div className="flex items-center space-x-2">
            <Package className="h-8 w-8 text-blue-600" />
            <h1 className="text-2xl font-bold text-slate-900">
              CampusShare
            </h1>
          </div>

          <nav className="hidden md:flex items-center space-x-8">
            <a href="#browse" className="hover:text-blue-600 transition">
              Browse
            </a>
            <a href="#safe-zones" className="hover:text-blue-600 transition">
              Safe Zones
            </a>
            <button className="bg-blue-600 text-white px-6 py-2 rounded-xl hover:bg-blue-700 transition shadow-md hover:shadow-lg">
              List an Item
            </button>
          </nav>
        </div>
      </header>

      <Hero />
      <Stats />

      {/* BROWSE SECTION */}
      <section id="browse" className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20">
        <div className="mb-10">
          <h2 className="text-3xl font-bold text-slate-900 mb-3">
            Browse Available Items
          </h2>
          <p className="text-slate-600">
            Rent from fellow students and save money.
          </p>
        </div>

        {/* SEARCH */}
        <div className="relative max-w-md mb-6">
          <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 h-5 w-5" />
          <input
            type="text"
            placeholder="Search items..."
            className="w-full pl-10 pr-4 py-3 border rounded-xl focus:ring-2 focus:ring-blue-500 outline-none"
            value={searchQuery}
            onChange={(e) => setSearchQuery(e.target.value)}
          />
        </div>

        <CategoryFilter
          selectedCategory={selectedCategory}
          onSelectCategory={setSelectedCategory}
        />

        {/* GRID */}
        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 mt-8">
          {filteredItems.map((item) => (
            <ItemCard
              key={item.id}
              item={item}
              onRent={handleRent}
            />
          ))}
        </div>

        {filteredItems.length === 0 && (
          <div className="text-center py-16">
            <Package className="h-16 w-16 text-slate-300 mx-auto mb-4" />
            <h3 className="text-xl font-semibold text-slate-700 mb-2">
              No items found
            </h3>
            <p className="text-slate-500">
              Try adjusting your search.
            </p>
          </div>
        )}
      </section>

      {/* SAFE ZONES */}
      <section id="safe-zones" className="py-20 bg-white">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <h2 className="text-3xl font-bold text-center mb-12">
            Scheduled Safe Zone Exchanges
          </h2>

          <div className="grid md:grid-cols-2 gap-8">
            {transactions.map((transaction) => {
              const zone = safeZones.find(
                (z) => z.id === transaction.safeZoneId
              );

              return zone ? (
                <SafeZoneTransaction
                  key={transaction.id}
                  safeZone={zone}
                  transaction={transaction}
                />
              ) : null;
            })}
          </div>
        </div>
      </section>

      {/* FOOTER */}
      <footer className="bg-slate-900 text-slate-400 py-10 text-center">
        <p>Â© 2026 CampusShare. Built for university communities.</p>
      </footer>
    </div>
  );
}

export default App;
